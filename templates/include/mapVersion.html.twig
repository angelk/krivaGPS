<script>
    {% for version in versions %}
        {
            let latlngs = [];

            {% for point in version.points %}
                latlngs.push([
                {{ point.lat }},
                {{ point.lng }}
                ]);
            {% endfor %}

            const track = new AppTrack(
                map,
                [L.polyline(latlngs, { color: "{{ color }}" })]
            );

            {% for waypoint in version.waypoints %}
                {
                let waypoint = L.marker([{{ waypoint.lat }}, {{ waypoint.lng }}]);
                waypoint.bindPopup({{ waypoint.name|json_encode|raw }});
                track.addWaypoint(waypoint);
                }
            {% endfor %}

            track.show();

            const buttonToggle = document.querySelectorAll("[data-type=track-toggle")[{{ index }}];
            buttonToggle.addEventListener('click', function() {
                track.toggle();
            });
        }

        {% set index = index + 1 %}
    {% endfor %}
</script>